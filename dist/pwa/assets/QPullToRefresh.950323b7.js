import{j as B,r as a,l as d,u as F,v as z,x as E,h as u,m as I,$ as O,a8 as j,Y as H,q as L,a9 as U}from"./index.4e7ffe61.js";import{T as V}from"./TouchPan.b34981f9.js";import{g as Y,a as D}from"./scroll.fd17398b.js";import{b as G}from"./format.00f09157.js";const r=40,T=20;var N=B({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:{default:void 0}},emits:["refresh"],setup(l,{slots:_,emit:b}){const{proxy:g}=L(),{$q:C}=g,t=a("pull"),i=a(0),o=a(!1),c=a(-r),f=a(!1),S=a({}),y=d(()=>({opacity:i.value,transform:`translateY(${c.value}px) rotate(${i.value*360}deg)`})),P=d(()=>"q-pull-to-refresh__puller row flex-center"+(f.value===!0?" q-pull-to-refresh__puller--animating":"")+(l.bgColor!==void 0?` bg-${l.bgColor}`:""));function $(e){if(e.isFinal===!0){o.value===!0&&(o.value=!1,t.value==="pulled"?(t.value="refreshing",v({pos:T}),x()):t.value==="pull"&&v({pos:-r,ratio:0}));return}if(f.value===!0||t.value==="refreshing")return!1;if(e.isFirst===!0){if(D(w)!==0||e.direction!=="down")return o.value===!0&&(o.value=!1,t.value="pull",v({pos:-r,ratio:0})),!1;o.value=!0;const{top:M,left:Q}=p.getBoundingClientRect();S.value={top:M+"px",left:Q+"px",width:window.getComputedStyle(p).getPropertyValue("width")}}U(e.evt);const s=Math.min(140,Math.max(0,e.distance.y));c.value=s-r,i.value=G(s/(T+r),0,1);const n=c.value>T?"pulled":"pull";t.value!==n&&(t.value=n)}const q=d(()=>{const e={down:!0};return l.noMouse!==!0&&(e.mouse=!0),[[V,$,void 0,e]]}),R=d(()=>`q-pull-to-refresh__content${o.value===!0?" no-pointer-events":""}`);function x(){b("refresh",()=>{v({pos:-r,ratio:0},()=>{t.value="pull"})})}function v({pos:e,ratio:s},n){f.value=!0,c.value=e,s!==void 0&&(i.value=s),clearTimeout(m),m=setTimeout(()=>{f.value=!1,n&&n()},300)}let p,w,m;function h(){w=Y(p,l.scrollTarget)}return F(()=>l.scrollTarget,h),z(()=>{p=g.$el,h()}),E(()=>{clearTimeout(m)}),Object.assign(g,{trigger:x,updateScrollTarget:h}),()=>{const e=[u("div",{class:R.value},I(_.default)),u("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:S.value},[u("div",{class:P.value,style:y.value},[t.value!=="refreshing"?u(O,{name:l.icon||C.iconSet.pullToRefresh.icon,color:l.color,size:"32px"}):u(j,{size:"24px",color:l.color})])])];return H("div",{class:"q-pull-to-refresh"},e,"main",l.disable===!1,()=>q.value)}}});export{N as Q};
