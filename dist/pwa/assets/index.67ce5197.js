import{_ as N,a as y,B as S,l as v,o as k,ad as B,g as a,w as c,Z as b,$ as w,a0 as d,am as x,V as _}from"./index.4e7ffe61.js";import{Q as C}from"./QBanner.0f8aee67.js";import{u as P}from"./use-quasar.bd546a85.js";import{api as W}from"./axios.0a2aaee7.js";import{u as q}from"./auth.f8643573.js";import"./use-dark.310a2ad4.js";import"./ref.4ae668e5.js";const A=q(),T=y({name:"notification-index",setup(){const n=P(),t=S({showNotificationsBanner:!0,serviceWorkerSupported:v(()=>"serviceWorker"in navigator),pushNotificationsSupported:v(()=>"PushManager"in window)}),l=()=>{t.showNotificationsBanner=!1,n.localStorage.set("neverShowNotificationsBanner",!0)},p=()=>{if(t.serviceWorkerSupported&&t.pushNotificationsSupported){let e;navigator.serviceWorker.ready.then(i=>(e=i,i.pushManager.getSubscription())).then(i=>{i||g(e)})}},f=()=>{console.log(t.pushNotificationsSupported),t.pushNotificationsSupported&&Notification.requestPermission(e=>{console.log("result: ",e),l(),e=="granted"&&p()})},m=()=>{t.serviceWorkerSupported&&t.pushNotificationsSupported&&navigator.serviceWorker.ready.then(e=>{e.showNotification("You're subscribed to notifications!",{body:"Thanks for subscribing!",icon:"/icons/icon-128x128.png",image:"/icons/icon-128x128.png",badge:"/icons/icon-128x128.png",dir:"ltr",lang:"en-US",vibrate:[100,50,200],tag:"confirm-notification",renotify:!0})})},h=e=>{const i="=".repeat((4-e.length%4)%4),u=(e+i).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(u),r=new Uint8Array(o.length);for(let s=0;s<o.length;++s)r[s]=o.charCodeAt(s);return r},g=e=>{let u=h("BK0MXQSsSTkLRsmGe4JxPNkA3jo9BTzlzeYl7IZ64L3YzlZuZwGBR5BfmoKNihcuLtNWiJTpFqLaf7O55aFF-vU");e.pushManager.subscribe({applicationServerKey:u,userVisibleOnly:!0}).then(o=>{let r=o.toJSON();W.post("/notification",{type:"subscription",data:r,id:A.active.id})}).then(o=>{m()}).catch(o=>{console.log("err: ",o)})};return{state:t,neverShowNotificationsBanner:l,checkForExistingPushSubscription:p,enableNotifications:f}}}),K={class:"banner-container bg-primary"},Q={class:"constrain"};function $(n,t,l,p,f,m){return k(),B("div",null,[a(_,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:c(()=>[b("div",K,[b("div",Q,[a(C,{class:"bg-grey-3 q-mb-md"},{avatar:c(()=>[a(w,{name:"eva-bell-outline",color:"primary"})]),action:c(()=>[a(d,{onClick:n.enableNotifications,label:"Yes",color:"primary",class:"q-px-sm",dense:"",flat:""},null,8,["onClick"]),a(d,{onClick:t[0]||(t[0]=h=>n.state.showNotificationsBanner=!1),label:"Later",color:"primary",class:"q-px-sm",dense:"",flat:""}),a(d,{onClick:n.neverShowNotificationsBanner,label:"Never",color:"primary",class:"q-px-sm",dense:"",flat:""},null,8,["onClick"])]),default:c(()=>[x(" Would you like to enable notifications? ")]),_:1})])])]),_:1})])}var Z=N(T,[["render",$]]);export{Z as default};
